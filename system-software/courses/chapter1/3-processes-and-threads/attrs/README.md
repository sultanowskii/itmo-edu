# Атрибуты процесса

## Контекст процесса (его атрибуты)

- Открытые файлы
- Файловые системы (mounted)
- Операции ввода/вывода
- Сетевое окружение
- Множество идентификаторов процессов
- Память
- Состояние регистров
- Hostname

Благодаря этому, можно изолировать процессы, создавая неймспейсы process id, ограничивая доступные части ФС и т.д.

Процессы-клоны (`clone()`) могут:

- получить копию атрибута
- иметь свой атрибут
- шарить с родителем (например, общая память, общее сетевое окружение)

Таким образом, с помощью clone можно более тонко задавать, источники атрибутов процесса-клона (в отличии от fork).

## `int clone(int (*fn)(void *_Nullable), void *stack, int flags, void *_Nullable arg, ...  /* pid_t *_Nullable parent_tid, void *_Nullable tls, pid_t *_Nullable child_tid */ );`

Важно: нужно указывать `_GNU_SOURCE`:

```c
#define _GNU_SOURCE
#include <sched.h>
```

- `fn` - функция, которая вызывается в процессе-клоне.
- `stack` - стек для процесса-клона. Можно указать адрес в памяти (например, аллоцировать). Если указать NULL, то клон будет использовать копию родительского стека в своей виртуальной памяти. ВАЖНО: это должна быть вершина стека. Если длина стека - `N+1`, то передавать нужно `STACK+N` (т.к. он растет вверх). Исключения по архитектурам можно посмотреть на man-странице (см.ниже).
- `flags` как раз отвечают за то, что делать с ресурсами.
- Остальные аргументы можно занулить.

В случае успеха, возвращает ID процесса.

Флаги (`flags`) имеют вид `CLONE_*` (`man 2 clone`). Например, если указать CLONE_PARENT, то тогда дочерний процесс будет не "сыном", а "братом".

Пример:
Без `CLONE_PARENT`:

```text
bash --- ./hello --- ./hello
```

С `CLONE_PARENT`:

```text
bash -+- ./hello 
      |
      +- ./hello
```
